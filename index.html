<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GrownFolk United: State Hubs</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f4f4f4; }
    .container { max-width: 1200px; margin: auto; }
    h1 { text-align: center; color: #333; }
    #searchBar { width: 100%; padding: 10px; font-size: 16px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 5px; }
    #walletWarning { display: none; color: red; text-align: center; margin-bottom: 20px; }
    #stateHubs { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
    .state-tile { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; }
    .state-tile a { color: #007bff; text-decoration: none; }
    .state-tile a.disabled { color: #999; pointer-events: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>GrownFolk United: State Hubs</h1>
    <div id="walletWarning">Please connect a Web3 wallet (e.g., MetaMask) to access state hubs.</div>
    <input type="text" id="searchBar" placeholder="Search states...">
    <div id="stateHubs"></div>
  </div>

  <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
  <script>
    // ResolverV2 contract configuration
    const resolverAddress = "0x0Af40B717f711471BE3738EB4963F81a233228C5";
    const resolverABI = [
      "function allowedSuffixes(string) view returns (bool)",
      "function getAllApprovedSuffixes() view returns (string[])"
    ];

    // State configuration for all 50 U.S. states
    const stateConfig = {
      "al.grownfolk": { name: "Alabama", emoji: "ðŸŒ„" },
      "ak.grownfolk": { name: "Alaska", emoji: "â„ï¸" },
      "az.grownfolk": { name: "Arizona", emoji: "ðŸœï¸" },
      "ar.grownfolk": { name: "Arkansas", emoji: "ðŸŒ²" },
      "ca.grownfolk": { name: "California", emoji: "ðŸŒ´" },
      "co.grownfolk": { name: "Colorado", emoji: "ðŸ”ï¸" },
      "ct.grownfolk": { name: "Connecticut", emoji: "ðŸ" },
      "de.grownfolk": { name: "Delaware", emoji: "ðŸ–ï¸" },
      "fl.grownfolk": { name: "Florida", emoji: "â˜€ï¸" },
      "ga.grownfolk": { name: "Georgia", emoji: "ðŸ‘" },
      "hi.grownfolk": { name: "Hawaii", emoji: "ðŸŒº" },
      "id.grownfolk": { name: "Idaho", emoji: "ðŸ¥”" },
      "il.grownfolk": { name: "Illinois", emoji: "ðŸŒ½" },
      "in.grownfolk": { name: "Indiana", emoji: "ðŸŽï¸" },
      "ia.grownfolk": { name: "Iowa", emoji: "ðŸŒ¾" },
      "ks.grownfolk": { name: "Kansas", emoji: "ðŸŒ»" },
      "ky.grownfolk": { name: "Kentucky", emoji: "ðŸŽ" },
      "la.grownfolk": { name: "Louisiana", emoji: "âšœï¸" },
      "me.grownfolk": { name: "Maine", emoji: "ðŸ¦ž" },
      "md.grownfolk": { name: "Maryland", emoji: "ðŸ¦€" },
      "ma.grownfolk": { name: "Massachusetts", emoji: "ðŸ¦ƒ" },
      "mi.grownfolk": { name: "Michigan", emoji: "ðŸžï¸" },
      "mn.grownfolk": { name: "Minnesota", emoji: "ðŸ’" },
      "ms.grownfolk": { name: "Mississippi", emoji: "ðŸŽ¶" },
      "mo.grownfolk": { name: "Missouri", emoji: "ðŸŒ‰" },
      "mt.grownfolk": { name: "Montana", emoji: "ðŸžï¸" },
      "ne.grownfolk": { name: "Nebraska", emoji: "ðŸŒ½" },
      "nv.grownfolk": { name: "Nevada", emoji: "ðŸŽ°" },
      "nh.grownfolk": { name: "New Hampshire", emoji: "ðŸ‚" },
      "nj.grownfolk": { name: "New Jersey", emoji: "ðŸ–ï¸" },
      "nm.grownfolk": { name: "New Mexico", emoji: "ðŸŒ¶ï¸" },
      "ny.grownfolk": { name: "New York", emoji: "ðŸ—½" },
      "nc.grownfolk": { name: "North Carolina", emoji: "ðŸ€" },
      "nd.grownfolk": { name: "North Dakota", emoji: "ðŸŒ¾" },
      "oh.grownfolk": { name: "Ohio", emoji: "ðŸˆ" },
      "ok.grownfolk": { name: "Oklahoma", emoji: "ðŸ¤ " },
      "or.grownfolk": { name: "Oregon", emoji: "ðŸŒ²" },
      "pa.grownfolk": { name: "Pennsylvania", emoji: "ðŸ””" },
      "ri.grownfolk": { name: "Rhode Island", emoji: "â›µ" },
      "sc.grownfolk": { name: "South Carolina", emoji: "ðŸŒ´" },
      "sd.grownfolk": { name: "South Dakota", emoji: "ðŸ—¿" },
      "tn.grownfolk": { name: "Tennessee", emoji: "ðŸŽ¸" },
      "tx.grownfolk": { name: "Texas", emoji: "ðŸ¤ " },
      "ut.grownfolk": { name: "Utah", emoji: "ðŸœï¸" },
      "vt.grownfolk": { name: "Vermont", emoji: "ðŸ" },
      "va.grownfolk": { name: "Virginia", emoji: "ðŸ›ï¸" },
      "wa.grownfolk": { name: "Washington", emoji: "â˜•" },
      "wv.grownfolk": { name: "West Virginia", emoji: "â›°ï¸" },
      "wi.grownfolk": { name: "Wisconsin", emoji: "ðŸ§€" },
      "wy.grownfolk": { name: "Wyoming", emoji: "ðŸžï¸" }
    };

    // Initialize ethers provider and contract
    let provider, resolverContract;
    async function initWeb3() {
      if (!window.ethereum) {
        document.getElementById("walletWarning").style.display = "block";
        return false;
      }
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      resolverContract = new ethers.Contract(resolverAddress, resolverABI, provider);
      return true;
    }

    // Placeholder function to check URL resolution (replace with real service)
    async function checkUrlResolution(url) {
      try {
        const response = await fetch(url, { method: "HEAD", mode: "no-cors" });
        return true; // Assume resolving if no error (customize as needed)
      } catch {
        return false;
      }
    }

    // Load and render state hubs
    async function loadStateHubs() {
      try {
        const approvedSuffixes = await resolverContract.getAllApprovedSuffixes();
        const hubs = await Promise.all(approvedSuffixes.map(async (suffix) => {
          const url = `https://${suffix}`;
          const isResolving = await checkUrlResolution(url);
          return {
            suffix,
            url,
            isResolving,
            display: stateConfig[suffix]?.name || suffix.replace(".grownfolk", ""),
            emoji: stateConfig[suffix]?.emoji || "ðŸŒŽ"
          };
        }));

        renderTiles(hubs.filter(hub => hub.isResolving));
      } catch (error) {
        console.error("Error loading state hubs:", error);
        document.getElementById("stateHubs").innerHTML = "<p>Error loading hubs. Please try again.</p>";
      }
    }

    // Render state hub tiles
    function renderTiles(hubs) {
      const stateHubsDiv = document.getElementById("stateHubs");
      stateHubsDiv.innerHTML = hubs.map(hub => `
        <div class="state-tile">
          <h3>${hub.emoji} ${hub.display}</h3>
          <a href="${hub.url}" class="${hub.isResolving ? '' : 'disabled'}" target="_blank">${hub.suffix}</a>
        </div>
      `).join("");
    }

    // Search bar filtering
    document.getElementById("searchBar").addEventListener("input", function(e) {
      const search = e.target.value.toLowerCase();
      const tiles = document.querySelectorAll(".state-tile");
      tiles.forEach(tile => {
        const stateName = tile.querySelector("h3").textContent.toLowerCase();
        tile.style.display = stateName.includes(search) ? "block" : "none";
      });
    });

    // Initialize on page load
    window.onload = async () => {
      const isWeb3Connected = await initWeb3();
      if (isWeb3Connected) {
        await loadStateHubs();
      }
    };
  </script>
</body>
</html>
